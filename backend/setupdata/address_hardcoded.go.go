package setupdata

import (
	"log"

	"github.com/PanuAutawo/CarTentManagement/backend/entity"
	"gorm.io/gorm"
)

// InsertHardcodedAddressData เพิ่มข้อมูลเขตและแขวงทั้งหมดของกรุงเทพมหานคร
func InsertHardcodedAddressData(db *gorm.DB) {
	// ตรวจสอบว่ามีข้อมูลอำเภอของ กทม. อยู่แล้วหรือไม่ ถ้ามีให้ข้าม
	var count int64
	db.Model(&entity.District{}).Where("province_id = ?", 1).Count(&count) // สมมติว่า ID ของ กทม. คือ 1
	if count > 0 {
		log.Println("Bangkok address data already exists. Skipping insertion.")
		return
	}

	log.Println("Start inserting hardcoded Bangkok address data...")

	// 1. ดึง ID ของจังหวัดกรุงเทพมหานคร
	var bkkProvince entity.Province
	if err := db.Where("province_name = ?", "Bangkok").First(&bkkProvince).Error; err != nil {
		log.Printf("Bangkok province not found. Please ensure 'Bangkok' exists in the 'provinces' table. Error: %v", err)
		return
	}

	// 2. ข้อมูลเขตและแขวงทั้งหมดของกรุงเทพมหานคร
	addressData := map[string][]string{
		"เขตพระนคร":      {"พระบรมมหาราชวัง", "วังบูรพาภิรมย์", "วัดราชบพิธ", "สำราญราษฎร์", "ศาลเจ้าพ่อเสือ", "เสาชิงช้า", "บวรนิเวศ", "ตลาดยอด", "ชนะสงคราม", "บ้านพานถม", "บางขุนพรหม", "วัดสามพระยา"},
		"เขตดุสิต":        {"ดุสิต", "วชิรพยาบาล", "สวนจิตรลดา", "สี่แยกมหานาค", "ถนนนครไชยศรี"},
		"เขตหนองจอก":     {"กระทุ่มราย", "หนองจอก", "คลองสิบ", "คลองสิบสอง", "โคกแฝด", "คู้ฝั่งเหนือ", "ลำผักชี", "ลำต้อยติ่ง"},
		"เขตบางรัก":       {"บางรัก", "สีลม", "สุริยวงศ์", "มหาพฤฒาราม", "สี่พระยา"},
		"เขตบางเขน":      {"อนุสาวรีย์", "ท่าแร้ง"},
		"เขตบางกะปิ":      {"บางกะปิ", "คลองจั่น", "หัวหมาก"},
		"เขตปทุมวัน":      {"วังใหม่", "ปทุมวัน", "ลุมพินี", "รองเมือง"},
		"เขตป้อมปราบศัตรูพ่าย": {"ป้อมปราบ", "วัดเทพศิรินทร์", "คลองมหานาค", "บ้านบาตร", "วัดโสมนัส"},
		"เขตพระโขนง":     {"บางจาก", "พระโขนงใต้"},
		"เขตมีนบุรี":       {"มีนบุรี", "แสนแสบ"},
		"เขตลาดกระบัง":    {"ลาดกระบัง", "คลองสองต้นนุ่น", "คลองสามประเวศ", "ลำปลาทิว", "ทับยาว", "ขุมทอง"},
		"เขตยานนาวา":     {"ช่องนนทรี", "บางโพงพาง"},
		"เขตสัมพันธวงศ์":  {"จักรวรรดิ", "สัมพันธวงศ์", "ตลาดน้อย"},
		"เขตพญาไท":       {"สามเสนใน", "พญาไท"},
		"เขตธนบุรี":       {"วัดกัลยาณ์", "หิรัญรูจี", "บางยี่เรือ", "บุคคโล", "ตลาดพลู", "ดาวคะนอง", "สำเหร่"},
		"เขตบางกอกใหญ่":   {"วัดอรุณ", "วัดท่าพระ"},
		"เขตห้วยขวาง":     {"ห้วยขวาง", "บางกะปิ", "สามเสนนอก"},
		"เขตคลองสาน":      {"สมเด็จเจ้าพระยา", "คลองสาน", "บางลำภูล่าง", "คลองต้นไทร"},
		"เขตตลิ่งชัน":     {"คลองชักพระ", "ตลิ่งชัน", "ฉิมพลี", "บางพรม", "บางระมาด", "บางเชือกหนัง"},
		"เขตบางกอกน้อย":   {"ศิริราช", "บ้านช่างหล่อ", "บางขุนนนท์", "บางขุนศรี", "อรุณอมรินทร์"},
		"เขตบางขุนเทียน":  {"บางขุนเทียน", "บางค้อ", "บางมด", "จอมทอง", "ท่าข้าม", "แสมดำ"},
		"เขตภาษีเจริญ":    {"บางหว้า", "บางด้วน", "บางจาก", "บางแวก", "คลองขวาง", "ปากคลองภาษีเจริญ", "คูหาสวรรค์"},
		"เขตหนองแขม":     {"หนองแขม", "หนองค้างพลู"},
		"เขตราษฎร์บูรณะ":  {"ราษฎร์บูรณะ", "บางปะกอก"},
		"เขตบางพลัด":     {"บางพลัด", "บางอ้อ", "บางบำหรุ", "บางยี่ขัน"},
		"เขตดินแดง":       {"ดินแดง", "รัชดาภิเษก"},
		"เขตบึงกุ่ม":       {"คลองกุ่ม", "นวมินทร์", "นวลจันทร์"},
		"เขตสาทร":        {"ทุ่งวัดดอน", "ยานนาวา", "ทุ่งมหาเมฆ"},
		"เขตบางซื่อ":      {"บางซื่อ", "วงศ์สว่าง"},
		"เขตจตุจักร":      {"ลาดยาว", "เสนานิคม", "จันทรเกษม", "จอมพล", "จตุจักร"},
		"เขตบางคอแหลม":   {"บางคอแหลม", "วัดพระยาไกร", "บางโคล่"},
		"เขตประเวศ":      {"ประเวศ", "หนองบอน", "ดอกไม้"},
		"เขตคลองเตย":     {"คลองเตย", "คลองตัน", "พระโขนง"},
		"เขตสวนหลวง":      {"สวนหลวง", "อ่อนนุช", "พัฒนาการ"},
		"เขตจอมทอง":      {"บางขุนเทียน", "บางค้อ", "บางมด", "จอมทอง"},
		"เขตดอนเมือง":      {"สีกัน", "ดอนเมือง", "สนามบิน"},
		"เขตราชเทวี":      {"ทุ่งพญาไท", "ถนนพญาไท", "ถนนเพชรบุรี", "มักกะสัน"},
		"เขตลาดพร้าว":      {"ลาดพร้าว", "จรเข้บัว"},
		"เขตวัฒนา":        {"คลองเตยเหนือ", "คลองตันเหนือ", "พระโขนงเหนือ"},
		"เขตบางแค":        {"บางแค", "บางแคเหนือ", "บางไผ่", "หลักสอง"},
		"เขตหลักสี่":       {"ทุ่งสองห้อง", "ตลาดบางเขน"},
		"เขตสายไหม":      {"สายไหม", "ออเงิน", "คลองถนน"},
		"เขตคันนายาว":     {"คันนายาว", "รามอินทรา"},
		"เขตสะพานสูง":     {"สะพานสูง", "ราษฎร์พัฒนา", "ทับช้าง"},
		"เขตวังทองหลาง":   {"วังทองหลาง", "สะพานสอง", "คลองเจ้าคุณสิงห์", "พลับพลา"},
		"เขตคลองสามวา":    {"สามวาตะวันตก", "สามวาตะวันออก", "บางชัน", "ทรายกองดิน", "ทรายกองดินใต้"},
		"เขตบางนา":        {"บางนาเหนือ", "บางนาใต้"},
		"เขตทวีวัฒนา":      {"ทวีวัฒนา", "ศาลาธรรมสพน์"},
		"เขตทุ่งครุ":        {"บางมด", "ทุ่งครุ"},
		"เขตบางบอน":      {"บางบอนเหนือ", "บางบอนใต้", "คลองบางพราน", "คลองบางบอน"},
	}

	tx := db.Begin()

	// 3. วนลูปสร้างข้อมูล
	for districtName, subDistrictNames := range addressData {
		// สร้างเขต (District)
		district := entity.District{
			DistrictName: districtName,
			ProvinceID:   bkkProvince.ID,
		}
		// ใช้ FirstOrCreate เพื่อป้องกันข้อมูลซ้ำซ้อน หากมีอยู่แล้วจะไม่สร้างใหม่
		if err := tx.Where(entity.District{DistrictName: districtName, ProvinceID: bkkProvince.ID}).FirstOrCreate(&district).Error; err != nil {
			log.Printf("Failed to create district %s: %v", districtName, err)
			tx.Rollback()
			return
		}

		// สร้างแขวง (SubDistrict)
		for _, subDistrictName := range subDistrictNames {
			subDistrict := entity.SubDistrict{
				SubDistrictName: subDistrictName,
				DistrictID:      district.ID,
			}
			if err := tx.Where(entity.SubDistrict{SubDistrictName: subDistrictName, DistrictID: district.ID}).FirstOrCreate(&subDistrict).Error; err != nil {
				log.Printf("Failed to create sub-district %s: %v", subDistrictName, err)
				tx.Rollback()
				return
			}
		}
	}

	if err := tx.Commit().Error; err != nil {
		log.Printf("Failed to commit address data transaction: %v", err)
		tx.Rollback()
		return
	}

	log.Println("Hardcoded Bangkok address data inserted successfully.")
}